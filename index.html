<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Color Noise</title>

  <!-- Cache control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0b0f18">

  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0; 
      min-height: 100vh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(120,120,255,.22), transparent 60%),
                  radial-gradient(1000px 700px at 80% 90%, rgba(0,255,200,.12), transparent 60%),
                  linear-gradient(135deg, #0b0f18, #070a10);
      background-attachment: fixed;
      color: #e8eefc;
    }
    
    /* Fixed header with player and timer */
    .fixedHeader {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(11, 15, 24, 0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 12px 16px;
    }
    
    .headerTop {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .logo {
      font-size: 20px;
      font-weight: 800;
      letter-spacing: -0.02em;
    }
    .logo a { color: inherit; text-decoration: none; }
    .version {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 6px;
      background: rgba(255,255,255,0.1);
      color: rgba(232,238,252,0.7);
      margin-left: 6px;
    }
    .byline {
      font-size: 11px;
      color: rgba(232,238,252,0.6);
    }
    
    /* Compact player */
    .playerRow {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .nowPlaying {
      flex: 1;
      font-size: 13px;
      color: rgba(232,238,252,0.8);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .nowPlaying .track {
      font-weight: 700;
      color: #e8eefc;
    }
    audio {
      width: 140px;
      height: 32px;
      flex-shrink: 0;
    }
    
    /* Compact timer */
    .timerRow {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.08);
    }
    .timerLabel {
      font-size: 11px;
      color: rgba(232,238,252,0.6);
    }
    .timerDisplay {
      font-size: 16px;
      font-weight: 800;
      font-variant-numeric: tabular-nums;
      min-width: 60px;
    }
    .timerDisplay.off { opacity: 0.4; }
    .timerControls {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .timerBtn {
      width: 28px; height: 28px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
    }
    .timerBtn:active { background: rgba(255,255,255,0.2); }
    .timerNum {
      font-size: 14px;
      font-weight: 700;
      min-width: 20px;
      text-align: center;
    }
    .timerStartBtn {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: #e8eefc;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      margin-left: auto;
    }
    .timerStartBtn:active { background: rgba(255,255,255,0.2); }
    
    /* Scrollable content */
    .content {
      padding: 16px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .sectionTitle {
      font-size: 13px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: rgba(232,238,252,0.6);
      margin: 16px 0 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .sectionTitle:first-child { margin-top: 0; }
    .collapseBtn {
      font-size: 12px;
      cursor: pointer;
      opacity: 0.6;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 10px;
    }
    
    .tile {
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.1);
      background: rgba(0,0,0,0.25);
      padding: 12px;
    }
    .tileTop {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .colorDot {
      width: 12px; height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
      box-shadow: 0 0 6px currentColor;
    }
    .name {
      font-size: 15px;
      font-weight: 700;
      flex: 1;
    }
    .favBtn {
      font-size: 16px;
      cursor: pointer;
      opacity: 0.4;
      transition: opacity 0.2s;
    }
    .favBtn:hover, .favBtn.active { opacity: 1; }
    .playBtn {
      padding: 6px 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.08);
      color: #e8eefc;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
    }
    .playBtn:hover { background: rgba(255,255,255,0.12); }
    .playBtn.active {
      background: rgba(120,180,255,0.25);
      border-color: rgba(120,180,255,0.5);
    }
    .desc {
      font-size: 12px;
      color: rgba(232,238,252,0.6);
      margin-top: 6px;
      line-height: 1.4;
    }
    
    .hidden { display: none !important; }
  </style>
</head>

<body>
  <!-- Fixed header with player and timer -->
  <div class="fixedHeader">
    <div class="headerTop">
      <div class="logo">
        <a href="https://en.wikipedia.org/wiki/Colors_of_noise" target="_blank">Color Noise</a>
        <span class="version">v1.5.1</span>
      </div>
      <div class="byline">by AboveAverageJoe</div>
    </div>
    
    <div class="playerRow">
      <div class="nowPlaying">
        <span class="track" id="nowPlayingTrack">Select a sound</span>
      </div>
      <audio id="player" controls playsinline preload="auto" loop></audio>
    </div>
    
    <div class="timerRow">
      <div class="timerLabel">Sleep</div>
      <div class="timerDisplay off" id="timerDisplay">0:00</div>
      <div class="timerControls">
        <div class="timerBtn" id="hMinus">−</div>
        <div class="timerNum" id="hours">0</div>
        <div class="timerLabel">h</div>
        <div class="timerBtn" id="hPlus">+</div>
        <div class="timerBtn" id="mMinus">−</div>
        <div class="timerNum" id="mins">0</div>
        <div class="timerLabel">m</div>
        <div class="timerBtn" id="mPlus">+</div>
      </div>
      <div class="timerStartBtn" id="toggleTimer">Start</div>
    </div>
  </div>

  <!-- Scrollable stations -->
  <div class="content">
    <div id="favoritesSection" class="hidden">
      <div class="sectionTitle">
        ★ Favorites
        <span class="collapseBtn" id="favCollapse">▼</span>
      </div>
      <div class="grid" id="favGrid"></div>
    </div>
    
    <div class="sectionTitle">Core Colors</div>
    <div class="grid" id="coreGrid"></div>
    
    <div class="sectionTitle">Nature + Noise Blends</div>
    <div class="grid" id="extraGrid"></div>
  </div>

<script>
(() => {
  const COLORS = {
    white: "#ffffff",
    pink: "#ff69b4",
    brown: "#8b4513",
    blue: "#4a90d9",
    green: "#2ecc71",
    red: "#cd5c5c"
  };

  const SOURCES_CORE = [
    {
      key: "white",
      name: "White",
      color: COLORS.white,
      desc: "Broad spectrum hiss. Best for masking sudden noises. 1 hour.",
      url: "https://archive.org/download/24-hours-lectrofan-sound-and-white-noise-river-128/1%20hour%20lectrofan%20sound%20and%20white%20noise%20river%20128.mp3"
    },
    {
      key: "pink",
      name: "Pink",
      color: COLORS.pink,
      desc: "Smoother than white. Feels like rainfall. 1 hour.",
      url: "https://archive.org/download/classical-music-mixed-with-pink-noise-for-sleep-and-relax_202105/Soothing%20Deep%20Pink%20Noise%20%201%20Hour.mp3"
    },
    {
      key: "brown",
      name: "Brown",
      color: COLORS.brown,
      desc: "Deep bass-heavy rumble. Very calming. 1 hour.",
      url: "https://archive.org/download/1-hour-brown-noise-and-flowing-water-320/1%20hour%20Brown%20Noise%20and%20Flowing%20River%20flac.mp3"
    },
    {
      key: "blue",
      name: "Blue",
      color: COLORS.blue,
      desc: "Higher frequencies. Masks high-pitched sounds. 1 hour.",
      url: "https://archive.org/download/1-hour-texas-river-rapids-and-deep-blue-noise-320/1%20hour%20texas%20river%20rapids%20and%20deep%20blue%20noise%20320.mp3"
    },
    {
      key: "green_pure",
      name: "Green (Pure)",
      color: COLORS.green,
      desc: "Coming soon — pure green noise source being sourced.",
      url: null
    },
    {
      key: "red",
      name: "Red (Deep Brown)",
      color: COLORS.red,
      desc: "Even deeper than brown. Extremely relaxing. 1 hour.",
      url: "https://archive.org/download/red-noise_202207/red%20noise.mp3"
    }
  ];

  const SOURCES_EXTRA = [
    {
      key: "blue_waterfall",
      name: "Blue + Waterfall",
      color: COLORS.blue,
      desc: "Blue noise with waterfall. 1 hour.",
      url: "https://archive.org/download/clip-waterfall-relaxing-sleep-rem-asmr/1%20hour%20waterfall%20relaxing%20sleep%20blue%20noise%20rem%20asmr%20320.mp3"
    },
    {
      key: "red_waterfall",
      name: "Red + Waterfall",
      color: COLORS.red,
      desc: "Deep red/brown with waterfall. 1 hour.",
      url: "https://archive.org/download/clip-waterfall-relaxing-sleep-rem-asmr/1%20hour%20waterfall%20relaxing%20rem%20red%20noise%20sleep%20320.mp3"
    },
    {
      key: "brown_river",
      name: "Brown + River",
      color: COLORS.brown,
      desc: "Brown noise with peaceful river. 1 hour.",
      url: "https://archive.org/download/24-hours-peaceful-river-and-brown-noise-vbr/1%20hour%20v3%20river%20and%20brown%20noise%20vbr.mp3"
    },
    {
      key: "brown_rain",
      name: "Brown + Rain",
      color: COLORS.brown,
      desc: "Brown noise with rain. 1 hour.",
      url: "https://archive.org/download/red-noise_202207/1-rain%20and%20brown%20noise%20-%20320%20-%201%20hour.mp3"
    },
    {
      key: "brown_stream",
      name: "Brown + Mountain Stream",
      color: COLORS.brown,
      desc: "Brown noise with stream and rain. 1 hour.",
      url: "https://archive.org/download/1-hour-mountain-stream-doubled-and-brown-noise-flac/1%20hour%20mountain%20stream%20-%20rain%20shower%20-%20brown%20noise%20v2%20320.mp3"
    },
    {
      key: "white_roaring",
      name: "White + Roaring Waterfall",
      color: COLORS.white,
      desc: "White noise with powerful waterfall. 10 hours.",
      url: "https://archive.org/download/1-fan-4-1-hour-flac/Roaring%20Waterfall%20White%20Noise%2010%20hours.mp3"
    },
    {
      key: "brown_terraced",
      name: "Brown + Terraced Waterfall",
      color: COLORS.brown,
      desc: "Brown noise with cascading water. 10 hours.",
      url: "https://archive.org/download/1-fan-4-1-hour-flac/10%20hours%20terraced%20waterfall%20brown%20noise%20sound%20128.mp3"
    },
    {
      key: "pink_reading",
      name: "Pink for Focus",
      color: COLORS.pink,
      desc: "Pink noise for reading/concentration. 1 hour.",
      url: "https://archive.org/download/classical-music-mixed-with-pink-noise-for-sleep-and-relax_202105/Pink%20Noise%20Focus%20on%20Reading%20Without%20DistractionsRuido%20RosaLeer%20Sin%20Distracciones.mp3"
    },
    {
      key: "green_stream",
      name: "Green + Stream",
      color: COLORS.green,
      desc: "Mountain stream — nature's green noise. 1 hour.",
      url: "https://archive.org/download/10-hours-white-noise-river-mountain-stream-doubled-320/1%20Hour%20Calming%20Mountain%20Stream.mp3"
    }
  ];

  const ALL_SOURCES = [...SOURCES_CORE, ...SOURCES_EXTRA];
  
  // Load favorites from localStorage
  let favorites = JSON.parse(localStorage.getItem('colorNoiseFavorites') || '[]');
  
  const player = document.getElementById("player");
  const nowPlayingTrack = document.getElementById("nowPlayingTrack");
  const coreGrid = document.getElementById("coreGrid");
  const extraGrid = document.getElementById("extraGrid");
  const favGrid = document.getElementById("favGrid");
  const favoritesSection = document.getElementById("favoritesSection");
  const favCollapse = document.getElementById("favCollapse");
  const timerDisplay = document.getElementById("timerDisplay");
  const toggleTimerBtn = document.getElementById("toggleTimer");
  const hoursEl = document.getElementById("hours");
  const minsEl = document.getElementById("mins");

  let currentKey = null;
  let favCollapsed = false;

  function saveFavorites() {
    localStorage.setItem('colorNoiseFavorites', JSON.stringify(favorites));
  }

  function toggleFavorite(key) {
    const idx = favorites.indexOf(key);
    if (idx === -1) {
      favorites.push(key);
    } else {
      favorites.splice(idx, 1);
    }
    saveFavorites();
    renderAll();
  }

  function setActive(key) {
    document.querySelectorAll(".playBtn").forEach(b => {
      const isActive = b.dataset.key === key;
      b.classList.toggle("active", isActive);
      if (b.textContent !== "Soon") {
        b.textContent = isActive ? "Playing" : "Play";
      }
    });
    
    document.querySelectorAll(".favBtn").forEach(b => {
      b.classList.toggle("active", favorites.includes(b.dataset.key));
      b.textContent = favorites.includes(b.dataset.key) ? "★" : "☆";
    });
  }

  function makeTile(item, inFavorites = false) {
    const tile = document.createElement("div");
    tile.className = "tile";

    const top = document.createElement("div");
    top.className = "tileTop";

    const dot = document.createElement("span");
    dot.className = "colorDot";
    dot.style.backgroundColor = item.color;
    dot.style.color = item.color;

    const name = document.createElement("span");
    name.className = "name";
    name.textContent = item.name;

    const favBtn = document.createElement("span");
    favBtn.className = "favBtn" + (favorites.includes(item.key) ? " active" : "");
    favBtn.textContent = favorites.includes(item.key) ? "★" : "☆";
    favBtn.dataset.key = item.key;
    favBtn.onclick = (e) => {
      e.stopPropagation();
      toggleFavorite(item.key);
    };

    const playBtn = document.createElement("div");
    playBtn.className = "playBtn" + (currentKey === item.key ? " active" : "");
    playBtn.dataset.key = item.key;
    
    if (item.url) {
      playBtn.textContent = currentKey === item.key ? "Playing" : "Play";
      playBtn.onclick = async () => {
        if (!item.url) return;
        
        if (currentKey === item.key && !player.paused) {
          player.pause();
          currentKey = null;
          nowPlayingTrack.textContent = "Select a sound";
          setActive(null);
          return;
        }

        currentKey = item.key;
        setActive(currentKey);
        nowPlayingTrack.textContent = "Loading...";

        try {
          player.pause();
          player.src = item.url;
          player.load();
          await player.play();
          nowPlayingTrack.textContent = item.name;
        } catch (e) {
          nowPlayingTrack.textContent = "Error: " + (e?.message || "Unknown");
        }
      };
    } else {
      playBtn.textContent = "Soon";
      playBtn.style.opacity = "0.5";
      playBtn.style.cursor = "default";
    }

    top.appendChild(dot);
    top.appendChild(name);
    top.appendChild(favBtn);
    top.appendChild(playBtn);

    const desc = document.createElement("div");
    desc.className = "desc";
    desc.textContent = item.desc;

    tile.appendChild(top);
    tile.appendChild(desc);
    return tile;
  }

  function renderAll() {
    // Render favorites
    favGrid.innerHTML = "";
    const favItems = ALL_SOURCES.filter(s => favorites.includes(s.key));
    
    if (favItems.length > 0 && !favCollapsed) {
      favoritesSection.classList.remove("hidden");
      favItems.forEach(s => favGrid.appendChild(makeTile(s, true)));
    } else if (favItems.length > 0 && favCollapsed) {
      favoritesSection.classList.remove("hidden");
      favGrid.innerHTML = "";
    } else {
      favoritesSection.classList.add("hidden");
    }
    
    favCollapse.textContent = favCollapsed ? "▶" : "▼";

    // Render core
    coreGrid.innerHTML = "";
    SOURCES_CORE.forEach(s => coreGrid.appendChild(makeTile(s)));

    // Render extra
    extraGrid.innerHTML = "";
    SOURCES_EXTRA.forEach(s => extraGrid.appendChild(makeTile(s)));
    
    setActive(currentKey);
  }

  favCollapse.onclick = () => {
    favCollapsed = !favCollapsed;
    renderAll();
  };

  // Timer logic
  let setHours = 0;
  let setMins = 0;
  let endTime = null;
  let timerInterval = null;

  function formatTime(ms) {
    if (ms <= 0) return "0:00";
    const totalSec = Math.ceil(ms / 1000);
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;
    if (h > 0) {
      return h + ":" + String(m).padStart(2, "0") + ":" + String(s).padStart(2, "0");
    }
    return m + ":" + String(s).padStart(2, "0");
  }

  function updateTimerDisplay() {
    if (!endTime) {
      timerDisplay.textContent = "0:00";
      timerDisplay.classList.add("off");
      return;
    }
    const remaining = endTime - Date.now();
    if (remaining <= 0) {
      stopTimer(true);
      return;
    }
    timerDisplay.textContent = formatTime(remaining);
    timerDisplay.classList.remove("off");
  }

  function startTimer() {
    const totalMs = (setHours * 3600 + setMins * 60) * 1000;
    if (totalMs <= 0) return;

    endTime = Date.now() + totalMs;
    toggleTimerBtn.textContent = "Stop";
    timerDisplay.classList.remove("off");
    
    updateTimerDisplay();
    timerInterval = setInterval(updateTimerDisplay, 1000);
  }

  function stopTimer(finished = false) {
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }
    
    if (finished) {
      player.pause();
      currentKey = null;
      nowPlayingTrack.textContent = "Timer finished";
      setActive(null);
    }
    
    endTime = null;
    toggleTimerBtn.textContent = "Start";
    timerDisplay.textContent = "0:00";
    timerDisplay.classList.add("off");
  }

  toggleTimerBtn.onclick = () => {
    if (endTime) {
      stopTimer(false);
    } else {
      startTimer();
    }
  };

  document.getElementById("hMinus").onclick = () => { 
    setHours = Math.max(0, setHours - 1); 
    hoursEl.textContent = setHours; 
  };
  document.getElementById("hPlus").onclick = () => { 
    setHours = Math.min(12, setHours + 1); 
    hoursEl.textContent = setHours; 
  };
  document.getElementById("mMinus").onclick = () => { 
    setMins = setMins - 15;
    if (setMins < 0) setMins = 45;
    minsEl.textContent = setMins; 
  };
  document.getElementById("mPlus").onclick = () => { 
    setMins = setMins + 15;
    if (setMins > 45) setMins = 0;
    minsEl.textContent = setMins; 
  };

  // Initial render
  renderAll();
})();
</script>
</body>
</html>
